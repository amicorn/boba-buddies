<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Strawberry Boba Gift üçì</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.js"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #FFF0F5; touch-action: none; }
        #ui { 
            position: absolute; bottom: 20px; width: 100%; text-align: center; 
            color: #ff69b4; font-family: 'Comic Sans MS', cursive; pointer-events: none;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="ui">Tap to Shake & Reset! üçì</div>

<script>
let engine, world;
let items = [];
let boundaries = [];

function setup() {
    // Create canvas to fit the screen exactly
    createCanvas(windowWidth, windowHeight);
    
    engine = Matter.Engine.create();
    world = engine.world;

    // Build the "Cup" walls relative to the screen size
    createCup();

    // Spawn 15 Boba pearls and 5 Strawberries
    for (let i = 0; i < 20; i++) {
        spawnItem(random(width * 0.3, width * 0.7), random(height * 0.2, height * 0.5));
    }
}

function createCup() {
    // Remove old walls if window is resized
    if (boundaries.length > 0) {
        Matter.World.remove(world, boundaries);
        boundaries = [];
    }

    let thickness = 100; 
    // Walls are placed just slightly off-screen or on the edge
    let ground = Matter.Bodies.rectangle(width/2, height + thickness/2, width, thickness, { isStatic: true });
    let leftWall = Matter.Bodies.rectangle(-thickness/2, height/2, thickness, height * 2, { isStatic: true });
    let rightWall = Matter.Bodies.rectangle(width + thickness/2, height/2, thickness, height * 2, { isStatic: true });
    let ceiling = Matter.Bodies.rectangle(width/2, -thickness/2, width, thickness, { isStatic: true });

    boundaries = [ground, leftWall, rightWall, ceiling];
    Matter.World.add(world, boundaries);
}

function spawnItem(x, y) {
    let type = random(['boba', 'boba', 'strawberry', 'character']);
    let radius = type === 'boba' ? 18 : 35;
    
    let body = Matter.Bodies.circle(x, y, radius, {
        restitution: 0.6,
        friction: 0.1,
        density: 0.001
    });
    
    body.label = type;
    items.push(body);
    Matter.World.add(world, body);
}

function draw() {
    background('#FFF0F5'); // Strawberry Milk Pink
    Matter.Engine.update(engine);

    // --- PHYSICS CONTROL ---
    if (window.innerWidth > 800) {
        // DESKTOP: Gravity follows Mouse
        let gx = map(mouseX, 0, width, -1.5, 1.5);
        let gy = map(mouseY, 0, height, -1.5, 1.5);
        engine.world.gravity.x = gx;
        engine.world.gravity.y = gy;
    } else {
        // MOBILE: Gravity follows Tilt
        let tx = map(rotationY, -30, 30, -1.5, 1.5);
        let ty = map(rotationX, -30, 30, -1.5, 1.5);
        engine.world.gravity.x = tx || 0;
        engine.world.gravity.y = ty || 1; // Default gravity down
    }

    // --- DRAWING ---
    for (let body of items) {
        let pos = body.position;
        push();
        translate(pos.x, pos.y);
        rotate(body.angle);
        
        if (body.label === 'boba') {
            fill(45, 30, 20); // Dark brown/black
            noStroke();
            ellipse(0, 0, 36);
            fill(255, 50); // Shine
            ellipse(-5, -5, 10);
        } else if (body.label === 'strawberry') {
            drawStrawberry();
        } else {
            drawCuteFace();
        }
        pop();
    }
}

function drawStrawberry() {
    fill('#FF4D4D');
    noStroke();
    ellipse(0, 0, 50, 60);
    fill('#32CD32'); // Leaf
    triangle(-15, -25, 15, -25, 0, -40);
}

function drawCuteFace() {
    // A simple "Line Friend" Style Bunny/Bear
    fill(255);
    stroke(0);
    strokeWeight(2);
    ellipse(0, 0, 70); // Face
    fill(0);
    noStroke();
    ellipse(-15, -5, 6); // Left Eye
    ellipse(15, -5, 6);  // Right Eye
    fill('#FFB6C1');
    ellipse(-22, 10, 10, 5); // Blush
    ellipse(22, 10, 10, 5);  // Blush
}

// RESET FUNCTION: If things get lost, click to bring them back
function mousePressed() {
    // Request iOS permissions
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission();
    }
    
    // Teleport all items to the center
    for (let body of items) {
        Matter.Body.setPosition(body, { x: width/2, y: height/2 });
        Matter.Body.setVelocity(body, { x: random(-5, 5), y: random(-5, 5) });
    }
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
    createCup();
}
</script>
</body>
</html>